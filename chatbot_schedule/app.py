from flask import Flask, request, jsonify, render_template
import re

app = Flask(__name__)

timetable = [
    "êµ­ì–´A, ë¯¸ìˆ , ì‚¬íšŒD(ìœ¤ë¦¬), ìŒì•…, ìˆ˜í•™A, ê³¼í•™D(ì§€êµ¬ê³¼í•™)",
    "í•œêµ­ì‚¬, ì˜ì–´B, ìŒì•…, ë¯¸ìˆ , ì˜ì–´A, ì²´ìœ¡, êµ­ì–´A",
    "ìˆ˜í•™B, ê³¼í•™A(ë¬¼ë¦¬), í•œêµ­ì‚¬, ì‚¬íšŒA(ì§€ë¦¬), ê³¼í•™ì‹¤í—˜, ìˆ˜í•™A",
    "ì˜ì–´A, êµ­ì–´B, ì‚¬íšŒC(ë„ì‹œ), í•œêµ­ì‚¬, ê³¼í•™C(ìƒëª…ê³¼í•™), ê³¼í•™B(í™”í•™), ì‚¬íšŒB(ë¬¸í™”)",
    "êµ­ì–´A, ì²´ìœ¡, ì˜ì–´B, ìˆ˜í•™A, ì ì‘, ìì¹˜"
]

test_schedule = [
    "12ì›” 8ì¼ë¶€í„° 12ì¼ê¹Œì§€"
]

school_event = [
    "10ì›” 31ì¼ êµ¬ê¸° ëŒ€íšŒ",
    "ëŒê³¶ì´ì œ"
]

assignments = [
    "11ì›” 10ì¼ ì‚¬íšŒD ìˆ˜í–‰í‰ê°€",
    "11ì›” 11ì¼ ë¯¸ìˆ  ë‚˜ë§Œì˜ ë¯¼í™” ë°œí‘œ",
    "11ì›” 16ì¼ ì˜ì–´B ì˜ì–´ ì›ê³  ì œì¶œ",
    "11ì›” 18ì¼ ì˜ì–´B ìˆ˜í–‰í‰ê°€",
    "11ì›” 20ì¼ êµ­ì–´B ìˆ˜í–‰í‰ê°€"
]

lunch_menu = {
    3: "ì°¹ìŒ€ë°¥<br>ì½©ë‚˜ë¬¼êµ­<br>í•´ë¬¼ì¡ì±„<br>ìŠ¤íŒ¸ê¹€ì¹˜êµ¬ì´<br>ë‹¨ë¬´ì§€<br>ë¯¸ë‹ˆë”¸ê¸°ì¿ í‚¤",
    4: "í‘ë¯¸ë°¥<br>ì‹œê¸ˆì¥ëœì¥êµ­<br>í”¼ìí•¨ë°•ìŠ¤í…Œì´í¬<br>ì• í˜¸ë°•ì–‘íŒŒë³¶ìŒ<br>ë°°ì¶”ê¹€ì¹˜<br>ì‚¬ê³¼",
    5: "ìŒ€ë°¥(ììœ¨)<br>ì–¼í°ìˆœë‘ë¶€ì°Œê°œ<br>ë‹­ë´‰ë°”ë² íì†ŒìŠ¤ì¡°ë¦¼<br>ê³¨ë±…ì´ì•¼ì±„ë¬´ì¹¨<br>ì½©ë‚˜ë¬¼ë¬´ì¹¨<br>ë°°ì¶”ê¹€ì¹˜<br>ë°©ìš¸í† ë§ˆí† ",
    6: "í‘ë¯¸ë°¥<br>ìˆœë‘ë¶€ì°Œê°œ<br>ì—ê·¸ëˆê¹ŒìŠ¤<br>ë‹¨í˜¸ë°•ìƒëŸ¬ë“œ<br>ë„í† ë¦¬ë¬µë¬´ì¹¨<br>ë°°ì¶”ê¹€ì¹˜<br>ê·¤",
    7: "ì¹´ë ˆë¼ì´ìŠ¤<br>ë‹­ê°•ì •<br>ë‹­ë‹¤ë¦¬êµ¬ì´<br>ì¹˜ì¦ˆë³¼<br>ì½©ë‚˜ë¬¼ë¬´ì¹¨/ê¹ë‘ê¸°<br>ê·¤",
    10: "í‘ë¯¸ë°¥<br>ë§‘ì€ìˆœëŒ“êµ­<br>ì•ˆë™ì‹ìˆœì‚´ì°œë‹­<br>ì½©ë‚˜ë¬¼ì¡ì±„<br>ê¹€êµ¬ì´<br>ì¡ê³¡ë°¥",
    11: "í‘ë¯¸ë°¥<br>ì œìœ¡ë‹¹ê·¼ìŒˆ+ê½ƒìƒì¶”<br>ë‹¤ì‹œë§ˆë¬´ì±„êµ­<br>ì—°ë‘ë¶€ì–‘ë…ì¥<br>ì™„ë‘ì½©ë°¥<br>ê³¼ë°”<br>ë°°ì¶”ê¹€ì¹˜",
    12: "ë§¤ì½¤ì†Œë³´ë£¨ë®ë°¥",
    13: "ëŒ€í•™ìˆ˜í•™ëŠ¥ë ¥ì‹œí—˜ (ììœ¨í•™ìŠµì‹¤ ìš´ì˜, ê¸‰ì‹ ì—†ìŒ)",
    14: "ì œìœ¡ë®ë°¥<br>ê³„ë€êµ­",
    17: "ì°¹ìŒ€ë°¥<br>ë“¤ê¹¨ë¯¸ì—­êµ­<br>ë‹­ë³¶ìŒíƒ•<br>ì¡ì±„<br>ìš°ì—‰ì±„ì¡°ë¦¼/ë°°ì¶”ê¹€ì¹˜<br>ì¼€ì´í¬",
    18: "ìì¥ë°¥<br>ì§¬ë½•êµ­ë¬¼<br>ìœ ë¶€ì´ˆë°¥<br>ëˆê°€ìŠ¤+ì†ŒìŠ¤<br>ì«„ë©´ì•¼ì±„ë¬´ì¹¨<br>ìˆ™ì£¼ë‚˜ë¬¼<br>ë°°ì¶”ê¹€ì¹˜",
    19: "ìŒ€ë°¥<br>í™©íƒœì±„ë¬´êµ­<br>ì˜¤ë¦¬ë¶ˆê³ ê¸°<br>ê°ìì±„ë³¶ìŒ<br>ì–‘ìƒì¶”ìƒëŸ¬ë“œ+í‚¤ìœ„D<br>ë°°ì¶”ê¹€ì¹˜<br>ì°¹ìŒ€ë„ë„ˆì¸ ",
    20: "ì°¹ìŒ€ë°¥<br>ê°ììœ¡ê°œì¥<br>ë–¡ê°ˆë¹„<br>ìƒˆìš°íŠ€ê¹€<br>ì–‘ë°°ì¶”ìˆ™ìŒˆ+ìŒˆì¥<br>ê¹ë‘ê¸°",
    21: "ì°¹ìŒ€ë°¥<br>ë©¸ì¹˜êµ­ìˆ˜<br>ê°ìí•«ë„ê·¸<br>ê¹€ë§ì´íŠ€ê¹€<br>ì‡ ë²½ê¹€ì¹˜<br>ìš”êµ¬ë¥´íŠ¸",
    24: "ìœ¨ë¬´ë°¥<br>ì„¤ë íƒ•<br>ì–¼ê°ˆì´ê²‰ì ˆì´<br>ë³¼ì–´ë¬µë³¶ìŒ<br>ë‘ë¶€ì‘¥ê°“ë¬´ì¹¨/ë°°ì¶”ê¹€ì¹˜<br>ë§Œë‘íŠ€ê¹€",
    25: "í‘ë¯¸ë°¥<br>ë¶ì–´ë¬´êµ­<br>ì›ì–‘ì‹ë¶ˆê³ ê¸°<br>êµ°ë§Œë‘<br>ì½©ë‚˜ë¬¼ë¬´ì¹¨<br>ìë‘ì£¼ìŠ¤<br>ë°°ì¶”ê¹€ì¹˜",
    26: "í‘ë¯¸ë°¥<br>ë¡œì œíŒŒìŠ¤íƒ€<br>ë§›ë™ì‚°íƒ•ìˆ˜ìœ¡<br>ê³ êµ¬ë§ˆìƒëŸ¬ë“œ<br>ì–‘ìƒì¶”ìƒëŸ¬ë“œ+ì¼€ìš”ë„¤ì¦ˆ<br>ì˜¤ì´í”¼í´<br>êµ¬ìŠ¬ì•„ì´ìŠ¤í¬ë¦¼<br>ë°°ì¶”ê¹€ì¹˜",
    27: "í‘ë¯¸ë°¥<br>ìˆœë‘ë¶€ê³ ì¶”ì¥ì°Œê°œ<br>ìƒì„ ê¹ŒìŠ¤+íƒ€ë¥´íƒ€ë¥´<br>3ìƒ‰ì•¼ì±„ê³„ë€ì°œ<br>ì—´ë¬´ë¬´ì¹¨<br>ë°°ì¶”ê¹€ì¹˜<br>ë§ê³ ë°”",
    28: "í‘ë¯¸ë°¥<br>ëˆì±„ê¹€ì¹˜ì°Œê°œ<br>ë©˜ì¹˜ê¹ŒìŠ¤<br>ë¯¸ë‹ˆìƒˆì†¡ì´ë³¶ìŒ<br>ì½©ë‚˜ë¬¼ë¬´ì¹¨<br>ë°°ì¶”ê¹€ì¹˜<br>ì–‘íŒŒë§"
}

def get_date_info(user_message):
    pattern = r"(\d+)\s*ì›”\s*(\d+)\s*ì¼"
    match = re.search(pattern, user_message)
    
    if not match:
        return None

    month_num_str = match.group(1)
    day_num_str = match.group(2)

    if month_num_str != "11":
        return "11ì›”ì˜ ì •ë³´ë§Œ ìˆìŠµë‹ˆë‹¤."

    try:
        day = int(day_num_str)
        if day in lunch_menu:
            return f"ğŸ½ï¸ 11ì›” {day}ì¼ ê¸‰ì‹:<br>{lunch_menu[day]}"
        else:
            return f"11ì›” {day}ì¼ì—ëŠ” ì¤‘ì‹ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. (ì£¼ë§ ë˜ëŠ” ê³µíœ´ì¼)"
    except ValueError:
        return None

@app.route("/")
def index():
    return render_template("index.html")

@app.route("/chat", methods=["POST"])
def chat():
    user_message = request.json.get("message", "")
    response = None

    if "ì‹œí—˜ì¼ì •" in user_message or "ì‹œí—˜ ì¼ì •" in user_message:
        response = "ğŸ“˜ ì‹œí—˜ ì¼ì •:<br>" + "<br>".join(f" - {item}" for item in test_schedule)

    elif "í•™êµí–‰ì‚¬" in user_message or "í•™êµ í–‰ì‚¬" in user_message:
        response = "ğŸ‰ í•™êµ í–‰ì‚¬:<br>" + "<br>".join(f" - {item}" for item in school_event)

    elif "ì›”ìš”ì¼" in user_message:
        response = "ì›”ìš”ì¼ ì‹œê°„í‘œ: " + timetable[0]
    
    elif "í™”ìš”ì¼" in user_message:
        response = "í™”ìš”ì¼ ì‹œê°„í‘œ: " + timetable[1]
    
    elif "ìˆ˜ìš”ì¼" in user_message:
        response = "ìˆ˜ìš”ì¼ ì‹œê°„í‘œ: " + timetable[2]
    
    elif "ëª©ìš”ì¼" in user_message:
        response = "ëª©ìš”ì¼ ì‹œê°„í‘œ: " + timetable[3]
    
    elif "ê¸ˆìš”ì¼" in user_message:
        response = "ê¸ˆìš”ì¼ ì‹œê°„í‘œ: " + timetable[4]
        
    elif "ìˆ˜í–‰í‰ê°€" in user_message or "ìˆ˜í–‰ í‰ê°€" in user_message:
        response = "âœï¸ ìˆ˜í–‰í‰ê°€ ì¼ì •:<br>" + "<br>".join(f" - {item}" for item in assignments)
    
    if response is None:
        date_response = get_date_info(user_message)
        if date_response:
            response = date_response
            
    if response is None:
        response = "ğŸ“¢ ìš”ì¼ì´ë‚˜ 'ì‹œí—˜ ì¼ì •', 'í•™êµ í–‰ì‚¬', 'ìˆ˜í–‰í‰ê°€', 'ê¸‰ì‹ì´ ê¶ê¸ˆí•œ ë‚ ì§œ'ë¥¼ í¬í•¨í•´ì„œ ì§ˆë¬¸í•´ ì£¼ì„¸ìš”!"

    return jsonify({"response": response})

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=5000, debug=True)

